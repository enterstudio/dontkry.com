<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Use this.files Not this.data | dontkry.com</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="body-posts-code-2013-04-24-use-this-files">
  <article class="main">
    <section class="avatar">
      <a href="/">
      <img src="http://www.gravatar.com/avatar/5211ea711bb06482530172f77732f61a.png" /></a>
    </section>
    <section class="name">
      kyle robinson young
    </section>
    <section class="about">
      open source developer, musician, juggler and father.
    </section>
    
    <section class="icons">
    
    
      <div class="icon">
        <a href="https://github.com/shama" target="_blank" title="github.com/shama">
<img src="/images/github.png" alt="github" width="28" style="margin: 1px 0 0 1px;" /></a>
      </div>
    
      <div class="icon">
        <a href="https://twitter.com/shamakry" target="_blank" title="twitter.com/shamakry">
<img src="/images/twitter.png" alt="twitter" width="32" /></a>
      </div>
    
      <div class="icon">
        <a href="http://750group.com" target="_blank" title="750group.com">
<img src="/images/750.png" alt="750 Group" width="65" style="margin: -3px 0 0 -17px;" /></a>
      </div>
    
      <div class="icon">
        <a href="http://gruntjs.com" target="_blank" title="gruntjs.com">
<img src="/images/gruntjs.png" alt="gruntjs.js" width="65" style="margin: -3px 0 0 -17px;" /></a>
      </div>
    
      <div class="icon">
        <a href="http://voxeljs.com" target="_blank" title="voxeljs.com">
<img src="/images/voxeljs.png" alt="voxel.js" width="35" style="margin: -2px 0 0 -3px;" /></a>
      </div>
    
    </section>

    <section class="large">
  <div class="header">
    <h1>
      Use this.files Not this.data&nbsp;
      <em class="date">Wed Apr 24 2013</em>
    </h1>
    
        <div class="project">
          <a href="http://gruntjs.com" target="_blank" title="gruntjs.com">
<img src="/images/gruntjs.png" alt="gruntjs.js" width="65" style="margin: -3px 0 0 -17px;" /></a>
        </div>
      
  </div>
  <div class="content">
    <p>The following contains <strong>only some of the ways</strong> users will target their files in a <code>Gruntfile.js</code>. The main job Grunt will do for you is take a bunch of configurations and give you a normalized simple array known as <code>this.files</code>. Here is a example that concatenates files:</p>
<pre class="highlighted"><code class="javascript"><span class="comment">// our Grunt config</span>
grunt.initConfig({
  example: {
    target: {
      src: [<span class="string">'lib/*.js'</span>],
      dest: <span class="string">'compiled.js'</span>,
    },
  },
});

<span class="comment">// our example task</span>
grunt.registerMultiTask(<span class="string">'example'</span>, <span class="keyword">function</span>() {
  <span class="keyword">this</span>.files.forEach(<span class="keyword">function</span>(file) {
    <span class="keyword">var</span> output = files.src.map(<span class="keyword">function</span>(filepath) {
      <span class="keyword">return</span> grunt.file.read(filepath);
    }).join(<span class="string">'\n'</span>);
    grunt.file.write(file.dest, output);
  });
});</code></pre>
<p>Now you may be tempted by a little API called <code>this.data</code>. Here is a task that does the same thing but uses this evil API:</p>
<pre class="highlighted"><code class="javascript"><span class="comment">// dont do this</span>
grunt.registerMultiTask(<span class="string">'example'</span>, <span class="keyword">function</span>() {
  <span class="keyword">var</span> output = grunt.file.expand(<span class="keyword">this</span>.data.src).map(<span class="keyword">function</span>(filepath) {
    <span class="keyword">return</span> grunt.file.read(filepath);
  }).join(<span class="string">'\n'</span>);
  grunt.file.write(<span class="keyword">this</span>.data.dest, output);
});</code></pre>
<p>The above example is bad because it <strong>only</strong> handles a single configuration: <code>src</code> and <code>dest</code> within a target.</p>
<p><br/>
This next configuration is perfectly valid in Grunt and users <em>will do this</em> even if you don&#39;t:</p>
<pre class="highlighted"><code class="javascript">grunt.initConfig({
  example: {
    <span class="string">'compiled.js'</span>: [<span class="string">'lib/*.js'</span>],
  },
});</code></pre>
<p>Nice and short. If your task uses <code>this.files</code> you don&#39;t have to change a thing. It just works.</p>
<p>What about you unfortunates that use <code>this.data</code>? Sorry, you will have to rewrite your task. But now you have to check whether the <code>target</code> is the <code>dest</code> and <code>this.data</code> is now the <code>src</code>. Have fun with that.</p>
<p><br/>
Here is another valid Grunt config:</p>
<pre class="highlighted"><code class="javascript">grunt.initConfig({
  example: {
    people: {
      files: {
        <span class="string">'girls'</span>: [<span class="string">'lib/girl_*'</span>],
        <span class="string">'boys'</span>: [<span class="string">'lib/boy_*'</span>],
      },
    },
  },
});</code></pre>
<p>Now the user can run <code>grunt example:people</code> to only concat people. Using <code>this.files</code>? Cool it works. Using <code>this.data</code>? Nope.</p>
<p><br/>
Let&#39;s change the example. What if my task compiled files such as minifying, templates or, I don&#39;t know, browserifying?</p>
<p>Eventually you&#39;ll need to compile to more than one <code>dest</code>. You could add a <code>&#39;dest&#39;: [&#39;src/*&#39;]</code> line for each one but around 10 or so it gets pretty ridiculous. Some cases you won&#39;t know the <code>dest</code> file.</p>
<p>This valid Grunt config will <code>uglify</code> each file within the <code>things/</code> folder and put each minified file into the <code>putaway/</code> folder:</p>
<pre class="highlighted"><code class="javascript">grunt.initConfig({
  uglify: {
    things: {
      src: [<span class="string">'things/*'</span>],
      dest: <span class="string">'putaway/'</span>,
      expand: <span class="literal">true</span>,
    },
  },
});</code></pre>
<p><code>this.files</code>... Yep.</p>
<p><code>this.data</code>... Nope.</p>
<p><br/>
Now what if I want to configure my <code>Gruntfile.js</code> to only compile files that have been modified in the last 24 hours? Try the most underused part of the Grunt API, <code>filter</code>:</p>
<pre class="highlighted"><code class="javascript">grunt.initConfig({
  concat: {
    logs: {
      src: [<span class="string">'logs/**/*'</span>],
      dest: <span class="string">"daily-&lt;%= grunt.template.today('yyyy-mm-dd') %&gt;.log"</span>,
      filter: <span class="keyword">function</span>(filepath) {
        <span class="keyword">var</span> mtime = <span class="keyword">new</span> Date(require(<span class="string">'fs'</span>).lstatSync(filepath).mtime).getTime();
        <span class="keyword">var</span> dayago = <span class="keyword">new</span> Date().getTime() - (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);
        <span class="keyword">return</span> (mtime &gt;= dayago);
      },
    },
  },
});</code></pre>
<p>Now you have daily logs concatenated. Oh yeah see how I used a template (<code>&lt;%= ... %&gt;</code>) within the <code>dest</code>? Make sure you process those templates <code>this.data</code> consumers.</p>
<p><br/>
We are just skimming the surface though. Here are some of the other file matching options availble: <code>nonull</code>, <code>dot</code>, <code>flatten</code>, <code>matchBase</code>, <code>cwd</code>, <code>ext</code>, <code>rename</code> as well as all the <a href="https://github.com/isaacs/node-glob">node-glob</a> and <a href="https://github.com/isaacs/minimatch">minimatch</a> options. <a href="http://gruntjs.com/configuring-tasks#files">View the Grunt docs</a> for more information on file matching.</p>
<p>The only acceptable use of <code>this.data</code> is if your task doesn&#39;t ever handle files. But those tasks are rare in the Grunt world.</p>
<h2>Conclusion</h2>
<p>It doesn&#39;t matter if you won&#39;t use these features. <strong>Other Grunt users will.</strong> Grunt was made to manage files. So if you&#39;re not utilizing <code>this.files</code> for managing files then why are you using Grunt?</p>

  </div>

  <div class="share">
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style">
<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
<a class="addthis_button_tweet"></a>
<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=undefined"></script>
<!-- AddThis Button END -->
</div>
</section>
  </article>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40418144-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
  <script  src="/js/bundle.js"></script>
</body>
</html>